<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="springbootmvcshopping.mapper.MemberMapper">
    <insert id="memberInsert" parameterType="MemberDTO">
        insert into members (MEMBER_NUM, MEMBER_NAME, MEMBER_ID, MEMBER_PW, MEMBER_ADDR,
                             MEMBER_ADDR_DETAIL, MEMBER_POST, MEMBER_REGIST, MEMBER_GENDER,
                             MEMBER_PHONE1, <if test="memberPhone2 != null">MEMBER_PHONE2</if>, MEMBER_EMAIL, MEMBER_BIRTH, MEMBER_POINT)
        values (#{memberNum}, #{memberName}, #{memberId}, #{memberPw}, #{memberAddr},
                #{memberAddrDetail}, #{memberPost}, sysdate, #{memberGender},
                #{memberPhone1}, <if test="memberPhone2 != null">#{memberPhone2}</if>, #{memberEmail}, #{memberBirth}, 0)
    </insert>
    
    <sql id="memberBaseColumns">
        MEMBER_NUM, MEMBER_NAME, MEMBER_ID, MEMBER_PW, MEMBER_ADDR,
        MEMBER_ADDR_DETAIL, MEMBER_POST, MEMBER_REGIST, MEMBER_GENDER,
        MEMBER_PHONE1, MEMBER_PHONE2, MEMBER_EMAIL, MEMBER_BIRTH, MEMBER_POINT, MEMBER_EMAIL_CONFIRM
    </sql>

    <select id="memberSelectList" resultType="memberDTO" parameterType="startEndPageDTO">
        select * from
        (select row_number() over (order by member_num asc ) as rn,
        <include refid="memberBaseColumns" /> from members
        <where>
            <if test="searchWord != null">
                MEMBER_NAME like '%'||#{searchWord}||'%'
                or MEMBER_ID like '%'||#{searchWord}||'%'
                or MEMBER_NUM like '%'||#{searchWord}||'%'
            </if>
        </where>
        )
        where rn between #{startRow} and #{endRow}
    </select>

    <select id="memberCount" resultType="integer">
        select count(*) from members
    </select>

    <select id="memberSelectOne" resultType="memberDTO" parameterType="string">
        select <include refid="memberBaseColumns"></include> from members where member_num = #{memberNum}
    </select>

</mapper>